# Задание:
**1. Напишите, какие есть проблемы у этого кода?**

**2. Сделайте рефакторинг данного кода.**
**Можно изменять названия методов, классов, добавлять входящие параметры, создавать новые классы и т.п.**
**Можно использовать псевдокод.**

-----

**Проблемы чистоты кода**
- Название класса не соответствует стандарту PSR-12
- Название метода `render_search_results` и `render_searh_result` не соответствует стандарту PSR-1, должен быть `renderSearchResults` и `renderSearchResult`
- скобки {} не соответствуют стандарту PSR-12, после них должен быть перенос строки
- Код должен иметь один пробел после управляющих структур и перед открывающей скобкой. код не соответствует этому стандарту. Добавить пробелы после if, elseif и перед {
- Операторы присваивания должны быть окружены пробелами с обеих сторон.
- namespace должен начинаться с заглавной буквы

-----

**Проблемы кода:**
- Уязвимость SQL-инъекции. Прямое использование значений `$_REQUEST` в SQL-запросах без надлежащей очистки может привести к SQL-инъекции.
- Прямое соединение с базой данных. Установление соединения с базой данных внутри метода не является гибким и не допускает повторного использования.
- Ведение журнала. Непосредственное открытие и запись в файл журнала без надлежащей обработки может вызвать проблемы, особенно при одновременном доступе.
- Ведение журнала. Используется мод `а+` (чтение из начала и добавление данных в конец файла), достаточно использовать режим записи `а`.
- Глобальные переменные. Использование глобальных переменных (`$render`) обычно является плохой практикой, поскольку может привести к неожиданному поведению.
- Волшебные строки: использование жестко запрограммированных строк для SQL-запросов и обработки действий.
- Отсутствие обработки ошибок. Код не содержит обработки ошибок, что может привести к непредсказуемому поведению при возникновении ошибок.
- `$_REQUEST['query'] = &$_REQUEST['q'];` - не нужно передавать по ссылке и нет смысла в создании нового ключа
- Безопасность. Использование `$_REQUEST` не рекомендуется, поскольку оно смешивает данные `$_GE`T и `$_POST`, что может привести к непредвиденному поведению.
- Нет тайпхинтов переменных и параметров методов, что может привезти к неожиданным ошибкам изза нестрогого сравнения данных или ошибки при попытке привести их к нужным

-----

**Проблемы по принципам SOLID:**
- Нарушение принципа единственной ответственности: метод `doSearch` выполняет сразу несколько задач - обработку запроса, выполнение поиска и отображение результатов.
- Нарушение принципа открытости/закрытости: класс `Search` не предоставляет возможности для расширения функционала без изменения исходного кода.
- Нарушение принципа инверсии зависимостей: класс `Search` зависит от конкретной реализации PDO, что затрудняет тестирование и поддержку кода.
- Нарушение принципа единства интерфейса: класс `Search` использует глобальную переменную $render, что делает его непереносимым и неудобным для использования в других проектах.
- Нарушение принципа минимальной утечки информации: класс `Search` выводит результаты поиска напрямую в браузер, что делает его непереиспользуемым и неудобным для интеграции в другие части приложения.

-----

**Сделанные улучшения:**
- Разделил логику подключения к БД, записи логов
- Выделил интерфейсы, можно было бы добавить инъекцию зависимостей с Абстрактоной фабрикой для создания инстанцов
- Разделил логику по принципам SOLID чтобы каждый метод отвечал за одну задачу и каждый класс занимался своей ролью
- Убрал возможность SQL-инъекции и обернул важные места в try-catch чтобы в будущем была возможность обработки ошибок

**Предложения:**
- Нужно вывести всю логику в сервисный слой, создать отдельный класс для обработки и валидации тела запроса перед тем как использовать эти данные в БД
- Создать Контроллер и Роутер классы, которые будут отвечать за отлов и перенаправление запросов
- Создать нормальный класс для Рендеринга результатов, который будет использовать шаблонизатор
- Использовать ORM для работы с базами данных
- Добавить переменные среды, чтобы секретные данные не хранились внутри кода
- Использовать composer для управления зависимостями
